---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/nodejsscan
    commands:
      - python /usr/src/app/cli.py -d dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: +LGGkdsxbZ5J49jYZ4cQKB7JaRl1ZL1azpJOMFtml7jVXjXpxohqVvk2Xjz4y6czlEwOISPs/MuB/BKrbWXNqQ==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 9415ddc069b4a7e2025032ef731a702c377b2c8e2e5bde085a0bb7d0c202aca8

...
